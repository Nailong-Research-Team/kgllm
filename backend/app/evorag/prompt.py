from string import Template


def format_template(template, **kwargs):
    return Template(template).substitute(**kwargs)


PROMPTS = {}

PROMPTS['SUMMARIZE_DESC'] = \
'''
# 目标
- 你是一个负责生成所提供数据全面摘要的有用助手。

# 步骤
1. 给定一个实体或关系（可能是一个实体或命名关系），以及一系列与同一实体或关系相关的描述。
2. 请将所有这些内容合并为单一的、全面的描述。确保包含从所有描述中收集的信息。
3. 如果提供的描述相互矛盾，请解决这些矛盾并提供一个连贯一致的摘要。
4. 确保使用第三人称写作，并包含实体名称以便我们有完整的上下文。
5. 使用纯文本格式，不要使用Markdown标签

# 数据
**实体/关系**:
$name

**描述**:
$desc

**输出**:
'''


PROMPTS['EXTRACT_ENTITIES'] = \
'''
# 目标
- 表现得像一个经验丰富的知识图谱构建者。
- 给定一个文本文档，识别文本中提到的所有重要实体。

# 步骤
1. 分析文本并识别所有重要实体。
2. 对于每个识别出的实体，提取以下信息：
   - `name`：实体的名称，正确大小写
   - `type`：此实体最合适的类型（例如，人物、组织、地点、事件、产品、概念、技术、职业、疾病、动物、植物等）
   - `desc`：文本中提到的该实体的属性和活动的全面描述
3. 将输出作为JSON数组返回，每个实体对象包含上述属性。

# 示例
**文本**:
张伟紧绷着下巴，他的挫折感在李明专制的确定性背景下显得黯淡无光。正是这种竞争性的暗流使他保持警觉，他和王芳对发现的共同承诺是对赵强狭隘的控制和秩序愿景的无声反抗。

然后李明做了一些出乎意料的事情。他在王芳旁边停下，片刻间，以一种近乎崇敬的态度观察着那台设备。"如果这项技术能被理解..."李明说，声音变得更轻，"它可能会改变我们的游戏规则。对我们所有人都是如此。"

先前的轻视似乎动摇了，取而代之的是对他们手中所握重要性的一丝不情愿的尊重。王芳抬头看，在转瞬即逝的一刻，他们的目光相遇，一场无声的意志碰撞软化为一种不安的休战。

这是一个微小的转变，几乎察觉不到，但张伟内心点头注意到了。他们都是通过不同的道路被带到这里的。

**输出**:
{
  "entities": [
    {
      "name": "张伟",
      "type": "人物",
      "desc": "张伟是一个感到挫折并观察其他角色之间动态的角色。"
    },
    {
      "name": "李明",
      "type": "人物",
      "desc": "李明表现出专制的确定性，并在观察一个设备时表现出崇敬之情，表明观点的转变。"
    },
    {
      "name": "王芳",
      "type": "人物",
      "desc": "王芳与发现有共同的承诺，并与李明就一个设备有重要互动。"
    },
    {
      "name": "赵强",
      "type": "人物",
      "desc": "赵强与控制和秩序的愿景相关联，影响着其他角色之间的动态。"
    },
    {
      "name": "设备",
      "type": "技术",
      "desc": "这个设备是故事的核心，具有潜在的改变游戏规则的影响，并受到李明的崇敬。"
    }
  ]
}

# 实际数据
**文本**:
$text

**输出**:
'''


PROMPTS['EXTRACT_RELATIONS'] = \
'''
# 目标
- 表现得像一个经验丰富的知识图谱构建者。
- 给定一个文本文档和已识别实体列表，提取这些实体之间所有有意义的关系。

# 步骤
1. 从提供的实体中，彻底分析文本并识别所有具有关系的（源，目标）对。
2. 对于每对相关实体，提取以下信息：
   - `source`：来自提供列表的源实体名称
   - `target`：来自提供列表的目标实体名称
   - `name`：描述关系类型的简洁标签（例如，"就职于"、"使用"、"位于"、"成员"、"合作"）
   - `desc`：基于文本解释这些实体如何相关
3. 实体必须严格使用提供的实体列表中的名称，不要发明或更改任何实体名称。
4. 将输出作为JSON数组返回，每个关系对象包含上述属性。

# 示例
**文本**:
张伟紧绷着下巴，他的挫折感在李明专制的确定性背景下显得黯淡无光。正是这种竞争性的暗流使他保持警觉，他和王芳对发现的共同承诺是对赵强狭隘的控制和秩序愿景的无声反抗。

然后李明做了一些出乎意料的事情。他在王芳旁边停下，片刻间，以一种近乎崇敬的态度观察着那台设备。"如果这项技术能被理解..."李明说，声音变得更轻，"它可能会改变我们的游戏规则。对我们所有人都是如此。"

先前的轻视似乎动摇了，取而代之的是对他们手中所握重要性的一丝不情愿的尊重。王芳抬头看，在转瞬即逝的一刻，他们的目光相遇，一场无声的意志碰撞软化为一种不安的休战。

这是一个微小的转变，几乎察觉不到，但张伟内心点头注意到了。他们都是通过不同的道路被带到这里的。

**实体**:
[('张伟', '人物'), ('李明', '人物'), ('王芳', '人物'), ('赵强', '人物'), ('设备', '技术')]

**输出**:
{
  "relations": [
    {
      "source": "张伟",
      "target": "李明",
      "name": "观察",
      "desc": "张伟受到李明专制确定性的影响，并观察到李明在与王芳互动期间对设备态度的变化。"
    },
    {
      "source": "张伟",
      "target": "王芳",
      "name": "合作",
      "desc": "张伟和王芳共同致力于发现。"
    },
    {
      "source": "李明",
      "target": "王芳",
      "name": "互动",
      "desc": "李明在王芳旁边停下，引发了涉及设备的互动，意志的碰撞，以及不安的休战，表现出不情愿的尊重。"
    },
    {
      "source": "王芳",
      "target": "赵强",
      "name": "反对",
      "desc": "王芳对发现的承诺被描述为对赵强控制和秩序愿景的反抗。"
    },
    {
      "source": "李明",
      "target": "设备",
      "name": "研究",
      "desc": "李明带着崇敬观察设备，并谈论如果理解它可能带来的改变游戏规则的影响。"
    },
    {
      "source": "张伟",
      "target": "赵强",
      "name": "反对理念",
      "desc": "张伟与王芳共享的承诺被描述为对赵强控制和秩序愿景的无声反抗。"
    },
    {
      "source": "张伟",
      "target": "王芳",
      "name": "观察",
      "desc": "张伟观察到涉及王芳和李明的互动和微小变化，内心注意到这一点。"
    }
  ]
}

# 实际数据
**文本**:
$text

**实体**:
$entities

**输出**:
'''


PROMPTS['CONTINUE_EXTRACT'] = \
'''
上次提取中遗漏了许多$type。
请使用相同格式添加它们：
'''


PROMPTS['LOOP_EXTRACT'] = \
'''
似乎可能仍然遗漏了一些$type。
如果仍有需要添加的$type，请只回答"是"或"否"。
'''

PROMPTS['KG_QUERY'] = \
'''
# 目标
- 你是一个基于知识图谱的问答助手
- 你需要根据系统检索的知识图谱信息回答用户的问题
- 使用Markdown格式组织你的回答

# 步骤
1. 仔细分析用户的问题
2. 审查提供的实体和关系信息
3. 基于这些信息构建全面准确的回答
4. 如果提供的信息不足以完全回答问题，请清楚地指出这一点，并根据可用信息提供部分回答

# 指南
- 只使用提供的知识图谱中的信息来回答问题
- 如果知识图谱为空，请清楚地指出无法回答
- 如果知识图谱中存在冲突，请指出这些冲突并尝试解释它们
- 不要编造知识图谱中不存在的信息
- 你的回答应该清晰、连贯

# 数据
**用户问题**:
$query

**实体信息**:
$entities

**关系信息**:
$relations

**回答**:
'''